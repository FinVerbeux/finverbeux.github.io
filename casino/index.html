<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Casino Nuit</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #12121a;
    --card-bg: #1a1a26;
    --accent: #e8c97a;
    --red: #e74c3c;
    --green: #2ecc71;
    --black-suit: #e8e8f0;
    --text: #e8e8f0;
    --muted: #6b6b8a;
    --border: #2a2a3d;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(ellipse 80% 60% at 50% -10%, rgba(232,201,122,0.08) 0%, transparent 70%),
      radial-gradient(ellipse 40% 40% at 80% 80%, rgba(199,62,43,0.06) 0%, transparent 60%);
    pointer-events: none;
    z-index: 0;
  }

  /* â”€â”€ SCREENS â”€â”€ */
  .screen {
    display: none;
    position: relative;
    z-index: 1;
    width: 100%;
    max-width: 720px;
    padding: 24px 20px;
    flex-direction: column;
    align-items: center;
    gap: 28px;
  }
  .screen.active { display: flex; }

  /* â”€â”€ HUB â”€â”€ */
  .hub-logo {
    text-align: center;
    margin-bottom: 8px;
  }
  .hub-logo h1 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(2.4rem, 7vw, 4rem);
    font-weight: 900;
    letter-spacing: -0.02em;
    color: var(--accent);
    text-shadow: 0 0 80px rgba(232,201,122,0.35);
  }
  .hub-logo p {
    color: var(--muted);
    font-size: 0.8rem;
    letter-spacing: 0.16em;
    text-transform: uppercase;
    margin-top: 6px;
  }

  .hub-cards {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    justify-content: center;
    width: 100%;
  }

  .hub-card {
    flex: 1;
    min-width: 240px;
    max-width: 320px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 36px 28px;
    cursor: pointer;
    text-align: center;
    position: relative;
    overflow: hidden;
    transition: transform 0.25s, border-color 0.25s, box-shadow 0.25s;
  }
  .hub-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--accent), transparent);
    opacity: 0;
    transition: opacity 0.3s;
  }
  .hub-card:hover { transform: translateY(-6px); border-color: var(--accent); box-shadow: 0 20px 60px rgba(232,201,122,0.12); }
  .hub-card:hover::before { opacity: 0.6; }

  .hub-card .game-icon {
    font-size: 3.5rem;
    margin-bottom: 16px;
    display: block;
    filter: drop-shadow(0 0 20px rgba(232,201,122,0.2));
  }
  .hub-card h2 {
    font-family: 'Playfair Display', serif;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--accent);
    margin-bottom: 8px;
  }
  .hub-card p {
    font-size: 0.82rem;
    color: var(--muted);
    line-height: 1.6;
  }
  .hub-card .play-tag {
    display: inline-block;
    margin-top: 20px;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--accent);
    border: 1px solid rgba(232,201,122,0.3);
    border-radius: 50px;
    padding: 6px 18px;
  }

  /* â”€â”€ SHARED HEADER â”€â”€ */
  .game-header {
    width: 100%;
    display: flex;
    align-items: center;
    gap: 16px;
  }
  .back-btn {
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 8px 14px;
    color: var(--muted);
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }
  .back-btn:hover { border-color: var(--accent); color: var(--accent); }
  .game-title {
    font-family: 'Playfair Display', serif;
    font-size: clamp(1.4rem, 4vw, 2rem);
    font-weight: 900;
    color: var(--accent);
    text-shadow: 0 0 40px rgba(232,201,122,0.25);
  }

  /* â”€â”€ SHARED CARD STYLES â”€â”€ */
  .card {
    width: 88px;
    height: 126px;
    border-radius: 12px;
    border: 1px solid var(--border);
    background: var(--card-bg);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-family: 'Playfair Display', serif;
    position: relative;
    flex-shrink: 0;
    transition: box-shadow 0.3s;
  }
  .card.hidden {
    background: linear-gradient(135deg, #1e1e2e, #12121a);
    border-color: var(--border);
  }
  .card.hidden::before { content: '?'; font-size: 2.8rem; color: var(--border); }
  .card.hidden::after {
    content: '';
    position: absolute;
    inset: 6px;
    border: 1px solid var(--border);
    border-radius: 8px;
    background: repeating-linear-gradient(45deg, transparent, transparent 4px, rgba(255,255,255,0.015) 4px, rgba(255,255,255,0.015) 5px);
  }
  .card.reveal { animation: flipIn 0.4s cubic-bezier(0.34,1.56,0.64,1) forwards; }
  @keyframes flipIn {
    0% { transform: rotateY(90deg) scale(0.8); opacity: 0; }
    100% { transform: rotateY(0deg) scale(1); opacity: 1; }
  }
  .card.correct { border-color: var(--green); box-shadow: 0 0 18px rgba(46,204,113,0.3); }
  .card.wrong   { border-color: var(--red);   box-shadow: 0 0 18px rgba(231,76,60,0.3); }

  .card-value { font-size: 1.8rem; line-height: 1; font-weight: 700; }
  .card-suit  { font-size: 1.2rem; line-height: 1; margin-top: 3px; }
  .card.red-card   .card-value, .card.red-card   .card-suit { color: var(--red); }
  .card.black-card .card-value, .card.black-card .card-suit { color: var(--black-suit); }

  /* small card for BJ */
  .card.sm { width: 68px; height: 98px; }
  .card.sm .card-value { font-size: 1.4rem; }
  .card.sm .card-suit  { font-size: 0.95rem; }
  .card.sm.hidden::before { font-size: 2rem; }

  /* â”€â”€ SURFACE BOX â”€â”€ */
  .box {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 24px 28px;
    width: 100%;
    position: relative;
    overflow: hidden;
  }
  .box::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; height: 1px;
    background: linear-gradient(90deg, transparent, var(--accent), transparent);
    opacity: 0.3;
  }

  /* â”€â”€ BUTTONS â”€â”€ */
  .btn {
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 13px 26px;
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 0.95rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    letter-spacing: 0.02em;
  }
  .btn:hover { border-color: var(--accent); color: var(--accent); background: rgba(232,201,122,0.05); transform: translateY(-2px); }
  .btn:disabled { opacity: 0.35; pointer-events: none; }
  .btn.primary { background: var(--accent); color: #0a0a0f; border-color: var(--accent); font-weight: 700; }
  .btn.primary:hover { box-shadow: 0 8px 24px rgba(232,201,122,0.3); color: #0a0a0f; }
  .btn.danger { border-color: rgba(231,76,60,0.4); color: var(--red); }
  .btn.danger:hover { border-color: var(--red); background: rgba(231,76,60,0.08); color: var(--red); }
  .btn.suit-btn { font-size: 1.3rem; padding: 11px 18px; min-width: 72px; }
  .btn.suit-btn.red-suit { color: var(--red); border-color: rgba(231,76,60,0.3); }
  .btn.suit-btn.red-suit:hover { border-color: var(--red); background: rgba(231,76,60,0.08); color: var(--red); }
  .btn.suit-btn.black-suit { color: var(--black-suit); }
  .btn.suit-btn.black-suit:hover { border-color: var(--black-suit); background: rgba(232,232,240,0.05); color: var(--black-suit); }

  .btn-row { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }

  /* â”€â”€ STEP DOTS â”€â”€ */
  .steps { display: flex; gap: 8px; }
  .step-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--border); transition: all 0.3s; }
  .step-dot.active { background: var(--accent); box-shadow: 0 0 10px var(--accent); transform: scale(1.3); }
  .step-dot.done { background: var(--muted); }

  /* â”€â”€ SCORE PILL â”€â”€ */
  .pill {
    display: flex; align-items: center; gap: 10px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 50px;
    padding: 9px 22px;
  }
  .pill .lbl { font-size: 0.72rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--muted); }
  .pill .val { font-family: 'Playfair Display', serif; font-size: 1.7rem; font-weight: 700; color: var(--red); }
  .pill .unit { font-size: 0.78rem; color: var(--muted); }

  /* â”€â”€ TOAST â”€â”€ */
  .toast {
    position: fixed;
    top: 24px; left: 50%;
    transform: translateX(-50%) translateY(-120px);
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 14px 26px;
    text-align: center;
    z-index: 200;
    min-width: 240px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    transition: transform 0.4s cubic-bezier(0.34,1.56,0.64,1);
  }
  .toast.show { transform: translateX(-50%) translateY(0); }
  .toast.ok  { border-color: var(--green); }
  .toast.ko  { border-color: var(--red); }
  .toast .t-icon  { font-size: 1.8rem; }
  .toast .t-title { font-family: 'Playfair Display', serif; font-size: 1.05rem; font-weight: 700; margin-top: 4px; }
  .toast .t-sub   { font-size: 0.78rem; color: var(--muted); margin-top: 3px; }

  /* â”€â”€ RIVIERE SPECIFIC â”€â”€ */
  .riv-cards-row {
    display: flex; gap: 12px; justify-content: center; align-items: flex-end;
    flex-wrap: wrap; min-height: 150px;
  }
  .card-slot { display: flex; flex-direction: column; align-items: center; gap: 6px; }
  .card-label { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--muted); }

  .riv-question-text {
    font-family: 'Playfair Display', serif;
    font-size: 1.2rem; font-weight: 700; color: var(--text); margin-bottom: 4px; text-align: center;
  }
  .riv-question-sub { font-size: 0.78rem; color: var(--muted); margin-bottom: 20px; text-align: center; }

  /* â”€â”€ BLACKJACK SPECIFIC â”€â”€ */
  .bj-area { display: flex; flex-direction: column; gap: 20px; width: 100%; }

  .bj-hand-label {
    font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.12em; color: var(--muted);
    margin-bottom: 10px;
  }
  .bj-hand-row { display: flex; gap: 8px; flex-wrap: wrap; align-items: flex-end; min-height: 108px; }

  .bj-score-badge {
    display: inline-flex; align-items: center; justify-content: center;
    font-family: 'Playfair Display', serif;
    font-size: 1.1rem; font-weight: 700;
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 4px 12px;
    margin-left: 10px;
    vertical-align: middle;
  }
  .bj-score-badge.bust { border-color: var(--red); color: var(--red); }
  .bj-score-badge.bj   { border-color: var(--accent); color: var(--accent); }
  .bj-score-badge.good { border-color: var(--green); color: var(--green); }

  .bj-result-box {
    text-align: center; padding: 28px;
  }
  .bj-result-title {
    font-family: 'Playfair Display', serif;
    font-size: 2rem; font-weight: 900; margin-bottom: 8px;
  }
  .bj-result-title.win  { color: var(--green); }
  .bj-result-title.lose { color: var(--red); }
  .bj-result-title.push { color: var(--accent); }
  .bj-result-sub { font-size: 0.85rem; color: var(--muted); }

  .bj-stats {
    display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;
  }
  .bj-stat {
    background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px;
    padding: 10px 20px; text-align: center;
  }
  .bj-stat .bs-val { font-family: 'Playfair Display', serif; font-size: 1.5rem; font-weight: 700; color: var(--accent); }
  .bj-stat .bs-lbl { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--muted); margin-top: 2px; }

  /* â”€â”€ HISTORY â”€â”€ */
  .history { width: 100%; }
  .history-title { font-size: 0.68rem; text-transform: uppercase; letter-spacing: 0.12em; color: var(--muted); margin-bottom: 8px; }
  .history-item {
    display: flex; justify-content: space-between; align-items: center;
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 10px; padding: 9px 16px; font-size: 0.82rem; margin-bottom: 6px;
    animation: slideIn 0.3s ease;
  }
  @keyframes slideIn { from { opacity:0; transform:translateX(-8px); } to { opacity:1; transform:translateX(0); } }
  .hi-label { color: var(--muted); font-size: 0.72rem; }
  .hi-val { font-family: 'Playfair Display', serif; font-size: 1rem; font-weight: 700; }
  .hi-val.red { color: var(--red); }
  .hi-val.green { color: var(--green); }
  .hi-val.gold { color: var(--accent); }

  /* â”€â”€ END SCREEN â”€â”€ */
  .end-box {
    background: var(--surface); border: 1px solid var(--border); border-radius: 24px;
    padding: 40px 32px; width: 100%; text-align: center; position: relative; overflow: hidden;
    display: flex; flex-direction: column; align-items: center; gap: 12px;
  }
  .end-box::before {
    content:''; position:absolute; top:0; left:0; right:0; height:1px;
    background: linear-gradient(90deg, transparent, var(--accent), transparent);
  }
  .end-box h2 { font-family:'Playfair Display',serif; font-size:2rem; font-weight:900; color:var(--accent); }
  .end-box .sips-big { font-family:'Playfair Display',serif; font-size:4rem; font-weight:900; color:var(--red); }
  .end-box p { color: var(--muted); font-size:0.85rem; }

  .disabled { pointer-events: none; opacity: 0.4; }
</style>
</head>
<body>

<!-- TOAST -->
<div class="toast" id="toast">
  <div class="t-icon" id="tIcon"></div>
  <div class="t-title" id="tTitle"></div>
  <div class="t-sub" id="tSub"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HUB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen active" id="screenHub">
  <div class="hub-logo">
    <h1>Casino Nuit</h1>
    <p>Choisis ton jeu</p>
  </div>

  <div class="hub-cards">
    <div class="hub-card" onclick="goTo('screenRiviere'); initRiviere()">
      <span class="game-icon">ğŸƒ</span>
      <h2>Monter la RiviÃ¨re</h2>
      <p>5 questions, 5 cartes. RÃ©ponds bien ou tu bois. Si tu rates, on reprend depuis le dÃ©but.</p>
      <span class="play-tag">Jouer â†’</span>
    </div>

    <div class="hub-card" onclick="goTo('screenBlackjack'); initBJ()">
      <span class="game-icon">ğŸ‚±</span>
      <h2>Blackjack</h2>
      <p>Tiens-toi en dessous de 21, bats le croupier. Simple, redoutable.</p>
      <span class="play-tag">Jouer â†’</span>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MONTER LA RIVIÃˆRE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="screenRiviere">
  <div class="game-header">
    <button class="back-btn" onclick="goHub()">â† Accueil</button>
    <span class="game-title">Monter la RiviÃ¨re</span>
  </div>

  <div style="display:flex; gap:12px; flex-wrap:wrap; justify-content:center;">
    <div class="pill">
      <span class="lbl">GorgÃ©es totales</span>
      <span class="val" id="rivTotalSips">0</span>
      <span class="unit">ğŸº</span>
    </div>
    <div class="pill" style="gap:8px; padding: 7px 18px;">
      <span class="lbl">Deck</span>
      <span style="font-family:'Playfair Display',serif; font-size:1.1rem; font-weight:700; color:var(--accent)" id="rivDeckCount">52</span>
      <span class="unit">cartes</span>
    </div>
  </div>

  <div class="steps" id="rivStepDots"></div>

  <div class="riv-cards-row" id="rivCardsRow"></div>

  <div class="box" id="rivQuestionBox">
    <div class="riv-question-text" id="rivQText"></div>
    <div class="riv-question-sub" id="rivQSub"></div>
    <div class="btn-row" id="rivChoices"></div>
  </div>

  <div id="rivEndBox" style="display:none" class="end-box">
    <div style="font-size:3rem">ğŸ»</div>
    <h2>Round terminÃ© !</h2>
    <p>Tu as accumulÃ©</p>
    <div class="sips-big" id="rivFinalSips">0</div>
    <p>gorgÃ©es cette manche</p>
    <p style="margin-top:6px">Les cartes restent Â· on repose par-dessus.</p>
    <button class="btn primary" style="margin-top:8px" onclick="rivNewRound()">Nouveau round</button>
  </div>

  <div class="history" id="rivHistory" style="display:none">
    <div class="history-title">Historique</div>
    <div id="rivHistoryList"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BLACKJACK â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="screenBlackjack">
  <div class="game-header">
    <button class="back-btn" onclick="goHub()">â† Accueil</button>
    <span class="game-title">Blackjack</span>
  </div>

  <div class="bj-stats" id="bjStats">
    <div class="bj-stat"><div class="bs-val" id="bjWins">0</div><div class="bs-lbl">Victoires</div></div>
    <div class="bj-stat"><div class="bs-val" id="bjLosses">0</div><div class="bs-lbl">DÃ©faites</div></div>
    <div class="bj-stat"><div class="bs-val" id="bjPushes">0</div><div class="bs-lbl">Ã‰galitÃ©s</div></div>
    <div class="bj-stat"><div class="bs-val" id="bjDeckCount" style="color:var(--accent)">52</div><div class="bs-lbl">Cartes deck</div></div>
  </div>

  <div class="bj-area">
    <!-- Croupier -->
    <div class="box">
      <div class="bj-hand-label">Croupier <span class="bj-score-badge" id="bjDealerBadge">?</span></div>
      <div class="bj-hand-row" id="bjDealerHand"></div>
    </div>
    <!-- Joueur -->
    <div class="box">
      <div class="bj-hand-label">Toi <span class="bj-score-badge" id="bjPlayerBadge">0</span></div>
      <div class="bj-hand-row" id="bjPlayerHand"></div>
    </div>
  </div>

  <!-- Actions -->
  <div class="btn-row" id="bjActions">
    <button class="btn primary" id="bjHitBtn"   onclick="bjHit()">Tirer ğŸƒ</button>
    <button class="btn"         id="bjStandBtn" onclick="bjStand()">Rester âœ‹</button>
    <button class="btn danger"  id="bjNewBtn"   onclick="bjNewGame()" style="display:none">Nouvelle partie ğŸ”„</button>
  </div>

  <!-- RÃ©sultat -->
  <div class="box bj-result-box" id="bjResultBox" style="display:none">
    <div class="bj-result-title" id="bjResultTitle"></div>
    <div class="bj-result-sub"   id="bjResultSub"></div>
  </div>

  <div class="history" id="bjHistory" style="display:none">
    <div class="history-title">Historique des parties</div>
    <div id="bjHistoryList"></div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function goTo(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo(0, 0);
}
function goHub() { goTo('screenHub'); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SHARED HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SUITS  = ['â™ ','â™£','â™¥','â™¦'];
const RED_SUITS = ['â™¥','â™¦'];
const VALUES = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
const FACE_CARDS = ['J','Q','K','A'];

function buildDeck() {
  const d = [];
  for (const s of SUITS) for (const v of VALUES) d.push({value: v, suit: s});
  return shuffle(d);
}
function shuffle(arr) {
  for (let i = arr.length-1; i > 0; i--) {
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}
function isRed(card) { return RED_SUITS.includes(card.suit); }
function isFace(card) { return FACE_CARDS.includes(card.value); }
function cardNumValue(card) { return VALUES.indexOf(card.value); }

function makeCardEl(card, hidden=false, small=false) {
  const el = document.createElement('div');
  el.className = 'card' + (small?' sm':'') + (hidden ? ' hidden' : ' reveal ' + (isRed(card)?'red-card':'black-card'));
  if (!hidden) {
    el.innerHTML = `<div class="card-value">${card.value}</div><div class="card-suit">${card.suit}</div>`;
  }
  return el;
}

let toastTimer = null;
function showToast(ok, icon, title, sub) {
  const t = document.getElementById('toast');
  document.getElementById('tIcon').textContent  = icon;
  document.getElementById('tTitle').textContent = title;
  document.getElementById('tSub').textContent   = sub;
  t.className = 'toast show ' + (ok ? 'ok' : 'ko');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => { t.className = 'toast'; }, 2200);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DECK PARTAGÃ‰ UNIQUE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let sharedDeck = buildDeck();

function sharedDraw() {
  if (sharedDeck.length === 0) sharedDeck = buildDeck();
  const card = sharedDeck.pop();
  updateDeckCounters();
  return card;
}

function updateDeckCounters() {
  const n = sharedDeck.length;
  const el1 = document.getElementById('rivDeckCount');
  const el2 = document.getElementById('bjDeckCount');
  if (el1) el1.textContent = n;
  if (el2) el2.textContent = n;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MONTER LA RIVIÃˆRE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const RIV_STEPS = [
  { q:'Rouge ou Noir ?',          sub:'Quelle couleur sera la 1Ã¨re carte ?',                    penalty:1 },
  { q:'Plus haut ou plus bas ?',  sub:'La 2Ã¨me carte sera plus haute ou plus basse que la 1Ã¨re ?', penalty:2 },
  { q:'IntÃ©rieur ou ExtÃ©rieur ?', sub:'La 3Ã¨me carte sera-t-elle entre les deux premiÃ¨res ?',   penalty:3 },
  { q:'TÃªte ou pas tÃªte ?',       sub:'La 4Ã¨me carte est-elle une tÃªte ? (J, Q, K, A)',         penalty:3 },
  { q:'Quelle enseigne ? â™  â™£ â™¥ â™¦', sub:'Choisis l\'enseigne de la 5Ã¨me carte.',               penalty:4 },
];

let rivCards = [];
let rivStep  = 0;
let rivTotalSips = 0;
let rivRoundSips = 0;
let rivWaiting = false;
let rivRoundCount = 0;

function initRiviere() {
  rivCards = [];
  updateDeckCounters();
  rivStep  = 0;
  rivTotalSips = 0;
  rivRoundSips = 0;
  rivWaiting = false;
  rivRoundCount = 0;
  document.getElementById('rivTotalSips').textContent = '0';
  document.getElementById('rivHistory').style.display = 'none';
  document.getElementById('rivHistoryList').innerHTML = '';
  document.getElementById('rivEndBox').style.display = 'none';
  document.getElementById('rivQuestionBox').style.display = 'block';
  rivRender();
  rivShowQ();
}

function rivRender() {
  // dots
  const dots = document.getElementById('rivStepDots');
  dots.innerHTML = '';
  for (let i=0; i<RIV_STEPS.length; i++) {
    const d = document.createElement('div');
    d.className = 'step-dot' + (i<rivStep?' done':'') + (i===rivStep?' active':'');
    dots.appendChild(d);
  }
  // cards
  const row = document.getElementById('rivCardsRow');
  row.innerHTML = '';
  const labels = ['Carte 1','Carte 2','Carte 3','Carte 4','Carte 5'];
  for (let i=0; i<RIV_STEPS.length; i++) {
    const slot = document.createElement('div');
    slot.className = 'card-slot';
    const lbl = document.createElement('div');
    lbl.className = 'card-label';
    lbl.textContent = labels[i];
    const card = i < rivCards.length
      ? makeCardEl(rivCards[i])
      : makeCardEl(null, true);
    slot.appendChild(lbl);
    slot.appendChild(card);
    row.appendChild(slot);
  }
}

function rivShowQ() {
  const s = RIV_STEPS[rivStep];
  document.getElementById('rivQText').textContent = s.q;
  document.getElementById('rivQSub').textContent  = s.sub;
  const ch = document.getElementById('rivChoices');
  ch.classList.remove('disabled');
  ch.innerHTML = '';
  if (rivStep === 0) {
    rivBtn(ch,'ğŸ”´ Rouge',()=>rivAnswer('rouge'));
    rivBtn(ch,'âš« Noir',  ()=>rivAnswer('noir'));
  } else if (rivStep === 1) {
    rivBtn(ch,'â¬† Plus haut',   ()=>rivAnswer('haut'));
    rivBtn(ch,'â¬‡ Plus bas',    ()=>rivAnswer('bas'));
    rivBtn(ch,'= MÃªme valeur', ()=>rivAnswer('egal'));
  } else if (rivStep === 2) {
    rivBtn(ch,'â†” IntÃ©rieur',   ()=>rivAnswer('inside'));
    rivBtn(ch,'â†” ExtÃ©rieur',   ()=>rivAnswer('outside'));
    rivBtn(ch,'= MÃªme valeur', ()=>rivAnswer('equal'));
  } else if (rivStep === 3) {
    rivBtn(ch,'ğŸ‘‘ TÃªte',     ()=>rivAnswer('tete'));
    rivBtn(ch,'ğŸ”¢ Pas tÃªte', ()=>rivAnswer('notete'));
  } else {
    for (const s of SUITS) {
      const b = document.createElement('button');
      b.className = 'btn suit-btn ' + (RED_SUITS.includes(s)?'red-suit':'black-suit');
      b.textContent = s;
      b.onclick = () => rivAnswer(s);
      ch.appendChild(b);
    }
  }
}

function rivBtn(parent, text, cb) {
  const b = document.createElement('button');
  b.className = 'btn';
  b.textContent = text;
  b.onclick = cb;
  parent.appendChild(b);
}

function rivAnswer(choice) {
  if (rivWaiting) return;
  rivWaiting = true;
  const card = sharedDraw();
  rivCards.push(card);
  rivRender();
  const correct = rivCheck(choice, card);
  const penalty = correct ? 0 : RIV_STEPS[rivStep].penalty;
  rivRoundSips += penalty;
  rivTotalSips  += penalty;
  document.getElementById('rivTotalSips').textContent = rivTotalSips;
  document.getElementById('rivChoices').classList.add('disabled');

  setTimeout(() => {
    // highlight card
    const cards = document.querySelectorAll('#rivCardsRow .card');
    if (cards[rivStep]) cards[rivStep].classList.add(correct?'correct':'wrong');

    if (correct) {
      showToast(true, 'âœ…', 'Bonne rÃ©ponse !', 'Tu avances !');
      rivStep++;
      rivRender();
      setTimeout(() => {
        rivWaiting = false;
        if (rivStep >= RIV_STEPS.length) rivShowEnd();
        else rivShowQ();
      }, 1600);
    } else {
      showToast(false, 'ğŸ˜¬', 'Mauvaise rÃ©ponse !', `+${penalty} gorgÃ©e${penalty>1?'s':''} Â· On repart du dÃ©but !`);
      setTimeout(() => {
        rivWaiting = false;
        rivStep  = 0;
        rivCards = [];
        rivRender();
        rivShowQ();
      }, 2000);
    }
  }, 400);
}

function rivCheck(choice, card) {
  if (rivStep === 0) {
    return (choice==='rouge' && isRed(card)) || (choice==='noir' && !isRed(card));
  } else if (rivStep === 1) {
    const v0=cardNumValue(rivCards[0]), v1=cardNumValue(card);
    if (choice==='haut') return v1>v0;
    if (choice==='bas')  return v1<v0;
    return v1===v0;
  } else if (rivStep === 2) {
    const v0=cardNumValue(rivCards[0]), v1=cardNumValue(rivCards[1]), v2=cardNumValue(card);
    const lo=Math.min(v0,v1), hi=Math.max(v0,v1);
    if (choice==='inside')  return v2>lo && v2<hi;
    if (choice==='outside') return v2<lo || v2>hi;
    return v2===lo || v2===hi;
  } else if (rivStep === 3) {
    return (choice==='tete' && isFace(card)) || (choice==='notete' && !isFace(card));
  } else {
    return choice === card.suit;
  }
}

function rivShowEnd() {
  document.getElementById('rivQuestionBox').style.display = 'none';
  document.getElementById('rivEndBox').style.display = 'flex';
  document.getElementById('rivFinalSips').textContent = rivRoundSips;
  rivRoundCount++;
  const hbox = document.getElementById('rivHistory');
  hbox.style.display = 'block';
  const list = document.getElementById('rivHistoryList');
  const item = document.createElement('div');
  item.className = 'history-item';
  item.innerHTML = `<span class="hi-label">Round ${rivRoundCount}</span><span>ComplÃ©tÃ© ğŸ‰</span><span class="hi-val ${rivRoundSips>0?'red':'green'}">${rivRoundSips>0?'+':''}${rivRoundSips} ğŸº</span>`;
  list.prepend(item);
}

function rivNewRound() {
  rivRoundSips = 0;
  rivCards     = [];
  rivStep      = 0;
  rivWaiting   = false;
  document.getElementById('rivEndBox').style.display = 'none';
  document.getElementById('rivQuestionBox').style.display = 'block';
  rivRender();
  rivShowQ();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BLACKJACK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let bjPlayerHand  = [];
let bjDealerHand  = [];
let bjGameOver    = false;
let bjWins=0, bjLosses=0, bjPushes=0;
let bjGameCount   = 0;

function bjCardValue(card) {
  if (['J','Q','K'].includes(card.value)) return 10;
  if (card.value === 'A') return 11;
  return parseInt(card.value);
}

function bjHandScore(hand) {
  let total = 0, aces = 0;
  for (const c of hand) {
    total += bjCardValue(c);
    if (c.value === 'A') aces++;
  }
  while (total > 21 && aces > 0) { total -= 10; aces--; }
  return total;
}

function initBJ() {
  bjWins=0; bjLosses=0; bjPushes=0;
  updateDeckCounters();
  bjGameCount = 0;
  document.getElementById('bjWins').textContent   = 0;
  document.getElementById('bjLosses').textContent = 0;
  document.getElementById('bjPushes').textContent = 0;
  document.getElementById('bjHistory').style.display = 'none';
  document.getElementById('bjHistoryList').innerHTML = '';
  bjNewGame();
}

function bjNewGame() {
  bjPlayerHand = [sharedDraw(), sharedDraw()];
  bjDealerHand = [sharedDraw(), sharedDraw()];
  bjGameOver = false;
  document.getElementById('bjResultBox').style.display = 'none';
  document.getElementById('bjNewBtn').style.display  = 'none';
  document.getElementById('bjHitBtn').style.display  = 'inline-flex';
  document.getElementById('bjStandBtn').style.display = 'inline-flex';
  document.getElementById('bjHitBtn').disabled   = false;
  document.getElementById('bjStandBtn').disabled = false;
  bjRender(false);

  // Auto blackjack check
  const ps = bjHandScore(bjPlayerHand);
  if (ps === 21) {
    setTimeout(() => bjResolve('bj-player'), 500);
  }
}

function bjRender(reveal) {
  // player
  const ph = document.getElementById('bjPlayerHand');
  ph.innerHTML = '';
  for (const c of bjPlayerHand) ph.appendChild(makeCardEl(c, false, true));
  const ps = bjHandScore(bjPlayerHand);
  const pb = document.getElementById('bjPlayerBadge');
  pb.textContent = ps;
  pb.className = 'bj-score-badge' + (ps>21?' bust':ps===21?' bj':' good');

  // dealer
  const dh = document.getElementById('bjDealerHand');
  dh.innerHTML = '';
  for (let i=0; i<bjDealerHand.length; i++) {
    dh.appendChild(makeCardEl(bjDealerHand[i], (!reveal && i===1), true));
  }
  const ds = reveal ? bjHandScore(bjDealerHand) : bjCardValue(bjDealerHand[0]);
  const db = document.getElementById('bjDealerBadge');
  if (!reveal) {
    db.textContent = ds + '+?';
    db.className = 'bj-score-badge';
  } else {
    db.textContent = bjHandScore(bjDealerHand);
    const full = bjHandScore(bjDealerHand);
    db.className = 'bj-score-badge' + (full>21?' bust':full===21?' bj':' good');
  }
}

function bjHit() {
  if (bjGameOver) return;
  bjPlayerHand.push(sharedDraw());
  bjRender(false);
  const ps = bjHandScore(bjPlayerHand);
  if (ps > 21) {
    bjResolve('bust-player');
  } else if (ps === 21) {
    bjStand();
  }
}

function bjStand() {
  if (bjGameOver) return;
  document.getElementById('bjHitBtn').disabled   = true;
  document.getElementById('bjStandBtn').disabled = true;
  bjRender(true);
  // dealer draws until >= 17
  const dealerDraw = () => {
    const ds = bjHandScore(bjDealerHand);
    if (ds < 17) {
      setTimeout(() => {
        bjDealerHand.push(sharedDraw());
        bjRender(true);
        dealerDraw();
      }, 600);
    } else {
      setTimeout(() => bjResolve('stand'), 400);
    }
  };
  dealerDraw();
}

function bjResolve(reason) {
  bjGameOver = true;
  const ps = bjHandScore(bjPlayerHand);
  const ds = bjHandScore(bjDealerHand);
  bjRender(true);

  let outcome, title, sub;
  if (reason === 'bj-player') {
    outcome='win'; title='Blackjack ! ğŸ°'; sub='21 du premier coup â€” belle entrÃ©e.';
  } else if (reason === 'bust-player') {
    outcome='lose'; title='Bust ! ğŸ’¥'; sub=`Tu dÃ©passes 21 avec ${ps} points.`;
  } else {
    if (ds > 21) {
      outcome='win'; title='Victoire !'; sub=`Le croupier bust Ã  ${ds}.`;
    } else if (ps > ds) {
      outcome='win'; title='Victoire !'; sub=`${ps} contre ${ds} pour le croupier.`;
    } else if (ds > ps) {
      outcome='lose'; title='DÃ©faite'; sub=`${ds} contre ${ps} pour toi.`;
    } else {
      outcome='push'; title='Ã‰galitÃ©'; sub=`${ps} partout.`;
    }
  }

  if (outcome==='win')       { bjWins++;   document.getElementById('bjWins').textContent   = bjWins;   }
  else if (outcome==='lose') { bjLosses++; document.getElementById('bjLosses').textContent = bjLosses; }
  else                       { bjPushes++; document.getElementById('bjPushes').textContent = bjPushes; }

  const rbox = document.getElementById('bjResultBox');
  rbox.style.display = 'block';
  const rt = document.getElementById('bjResultTitle');
  rt.textContent = title;
  rt.className = 'bj-result-title ' + outcome;
  document.getElementById('bjResultSub').textContent = sub;

  document.getElementById('bjHitBtn').style.display   = 'none';
  document.getElementById('bjStandBtn').style.display = 'none';
  document.getElementById('bjNewBtn').style.display   = 'inline-flex';

  // history
  bjGameCount++;
  const hbox = document.getElementById('bjHistory');
  hbox.style.display = 'block';
  const list = document.getElementById('bjHistoryList');
  const item = document.createElement('div');
  item.className = 'history-item';
  const cls = outcome==='win'?'green':outcome==='lose'?'red':'gold';
  const emoji = outcome==='win'?'âœ…':outcome==='lose'?'âŒ':'ğŸ¤';
  item.innerHTML = `<span class="hi-label">Partie ${bjGameCount}</span><span>${emoji} ${title}</span><span class="hi-val ${cls}">${ps} pts</span>`;
  list.prepend(item);
}
</script>
</body>
</html>
